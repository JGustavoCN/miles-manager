@using Miles.WebApp.Auth
@inject Microsoft.AspNetCore.Components.Authorization.AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation

<div class="nav-menu-custom">
    <div class="nav-header">
        <MudIcon Icon="@Icons.Material.Filled.Dashboard" Color="Color.Primary" Size="Size.Large" Class="mr-3" />
        <div>
            <MudText Typo="Typo.subtitle1" Class="nav-title">Navegação</MudText>
            <MudText Typo="Typo.caption" Class="mud-text-secondary">Miles Manager</MudText>
        </div>
    </div>

    <MudDivider Class="my-4" />

    <MudNavMenu Class="nav-menu-items">
        <MudNavLink Href="/" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home" Class="nav-link-custom">
            <div class="nav-link-content">
                <MudText Typo="Typo.body1">Início</MudText>
                <MudText Typo="Typo.caption" Class="mud-text-secondary">Página Principal</MudText>
            </div>
        </MudNavLink>

        <AuthorizeView>
            <Authorized>
                <MudNavLink Href="/dashboard" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Dashboard"
                    Class="nav-link-custom">
                    <div class="nav-link-content">
                        <MudText Typo="Typo.body1">Dashboard</MudText>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">Visão Geral</MudText>
                    </div>
                </MudNavLink>

                <MudNavLink Href="/cartoes" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.CreditCard"
                    Class="nav-link-custom">
                    <div class="nav-link-content">
                        <MudText Typo="Typo.body1">Cartões</MudText>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">Gerencie seus cartões</MudText>
                    </div>
                </MudNavLink>

                <MudNavLink Href="/compras" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Receipt"
                    Class="nav-link-custom">
                    <div class="nav-link-content">
                        <MudText Typo="Typo.body1">Compras</MudText>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">Extrato e transações</MudText>
                    </div>
                </MudNavLink>

                <MudNavLink Href="/programas" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.CardGiftcard"
                    Class="nav-link-custom">
                    <div class="nav-link-content">
                        <MudText Typo="Typo.body1">Programas</MudText>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">Fidelidade e milhas</MudText>
                    </div>
                </MudNavLink>

                <MudDivider Class="my-4" />

                <MudNavLink Href="/configuracoes" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Settings"
                    Class="nav-link-custom">
                    <div class="nav-link-content">
                        <MudText Typo="Typo.body1">Configurações</MudText>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">Preferências</MudText>
                    </div>
                </MudNavLink>

                <MudNavLink OnClick="@HandleLogout" Icon="@Icons.Material.Filled.Logout"
                    Class="nav-link-custom logout-link">
                    <div class="nav-link-content">
                        <MudText Typo="Typo.body1">Sair</MudText>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">Logout</MudText>
                    </div>
                </MudNavLink>
            </Authorized>
            <NotAuthorized>
                <MudNavLink Href="/login" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Login"
                    Class="nav-link-custom">
                    <div class="nav-link-content">
                        <MudText Typo="Typo.body1">Entrar</MudText>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">Acessar conta</MudText>
                    </div>
                </MudNavLink>
            </NotAuthorized>
        </AuthorizeView>

        <MudDivider Class="my-4" />

        <MudNavGroup Title="Desenvolvimento" Icon="@Icons.Material.Filled.Code" Expanded="false"
            Class="nav-group-custom">
            <MudNavLink Href="/counter" Icon="@Icons.Material.Filled.Add">
                Counter (Demo)
            </MudNavLink>
            <MudNavLink Href="/weather" Icon="@Icons.Material.Filled.Cloud">
                Weather (Demo)
            </MudNavLink>
            <MudNavLink Href="/teste-mudblazor" Icon="@Icons.Custom.Brands.MudBlazor">
                Teste MudBlazor
            </MudNavLink>
            <MudNavLink Href="/test-logging"
                Icon="<image href='https://raw.githubusercontent.com/serilog/serilog.github.io/master/images/serilog-180px.png' x='0' y='0' height='24' width='24'/>">
                Teste de Logging
            </MudNavLink>
        </MudNavGroup>
    </MudNavMenu>
</div>

@code {
    private async Task HandleLogout()
    {
        var authStateProvider = (CustomAuthenticationStateProvider)AuthStateProvider;
        await authStateProvider.MarkUserAsLoggedOutAsync();
        Navigation.NavigateTo("/login", true);
    }
}