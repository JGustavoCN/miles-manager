@page "/test-logging"
@using Microsoft.Extensions.Logging
@using MudBlazor
@inject ILogger<TestLogging> Logger

<PageTitle>Teste de Logging</PageTitle>

<h3>üß™ Teste de Logging e Exception Handling</h3>

<MudGrid>
    <MudItem xs="12">
        <MudPaper Elevation="2" Class="pa-4">
            <MudText Typo="Typo.h6" GutterBottom="true">Teste de N√≠veis de Log</MudText>
            <MudStack Spacing="2">
                <MudButton Variant="Variant.Filled" Color="Color.Info" OnClick="LogTrace">Trace</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Default" OnClick="LogDebug">Debug</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="LogInformation">Information</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Warning" OnClick="LogWarning">Warning</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="LogError">Error</MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Dark" OnClick="LogCritical">Critical</MudButton>
            </MudStack>
        </MudPaper>
    </MudItem>

    <MudItem xs="12">
        <MudPaper Elevation="2" Class="pa-4">
            <MudText Typo="Typo.h6" GutterBottom="true">Teste de Exception Handling</MudText>
            <MudAlert Severity="Severity.Warning" Class="mb-4">
                ‚ö†Ô∏è Os bot√µes abaixo v√£o lan√ßar exce√ß√µes propositalmente para testar o middleware global.
            </MudAlert>
            <MudStack Spacing="2">
                <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="ThrowException">
                    Lan√ßar InvalidOperationException
                </MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="ThrowArgumentException">
                    Lan√ßar ArgumentNullException
                </MudButton>
                <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="ThrowDivideByZero">
                    Lan√ßar DivideByZeroException
                </MudButton>
            </MudStack>
        </MudPaper>
    </MudItem>

    <MudItem xs="12">
        <MudPaper Elevation="2" Class="pa-4">
            <MudText Typo="Typo.h6" GutterBottom="true">Logs Estruturados</MudText>
            <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="LogStructured">
                Criar Log Estruturado
            </MudButton>
            <MudText Typo="Typo.caption" Class="mt-2">
                Logs estruturados incluem propriedades sem√¢nticas que facilitam queries e an√°lise.
            </MudText>
        </MudPaper>
    </MudItem>

    <MudItem xs="12">
        <MudAlert Severity="Severity.Info">
            <MudText>
                <strong>Como verificar os logs:</strong><br/>
                1. <strong>Console:</strong> Veja os logs coloridos no terminal<br/>
                2. <strong>Arquivo:</strong> Abra <code>Logs/miles-log-{Data}.txt</code><br/>
                3. <strong>Exce√ß√µes:</strong> Veja a resposta JSON no DevTools do navegador
            </MudText>
        </MudAlert>
    </MudItem>
</MudGrid>

@code {
    private void LogTrace()
    {
        Logger.LogTrace("Este √© um log de TRACE (mais detalhado, usado para diagn√≥stico profundo)");
    }

    private void LogDebug()
    {
        Logger.LogDebug("Este √© um log de DEBUG (informa√ß√µes √∫teis durante desenvolvimento)");
    }

    private void LogInformation()
    {
        Logger.LogInformation("Este √© um log de INFORMATION (fluxo normal da aplica√ß√£o)");
    }

    private void LogWarning()
    {
        Logger.LogWarning("Este √© um log de WARNING (algo inesperado, mas n√£o √© erro)");
    }

    private void LogError()
    {
        Logger.LogError("Este √© um log de ERROR (erro recuper√°vel)");
    }

    private void LogCritical()
    {
        Logger.LogCritical("Este √© um log de CRITICAL (falha cr√≠tica que requer aten√ß√£o imediata)");
    }

    private void ThrowException()
    {
        Logger.LogWarning("Preparando para lan√ßar InvalidOperationException...");
        throw new InvalidOperationException("Teste do ExceptionHandlingMiddleware - InvalidOperationException");
    }

    private void ThrowArgumentException()
    {
        Logger.LogWarning("Preparando para lan√ßar ArgumentNullException...");
        throw new ArgumentNullException("userId", "O par√¢metro userId n√£o pode ser nulo");
    }

    private void ThrowDivideByZero()
    {
        Logger.LogWarning("Preparando para lan√ßar DivideByZeroException...");
        int zero = 0;
        int result = 10 / zero; // Vai lan√ßar exce√ß√£o
    }

    private void LogStructured()
    {
        // Log estruturado com propriedades sem√¢nticas
        var userId = Guid.NewGuid();
        var username = "john.doe@example.com";
        var action = "TestLogin";
        var ipAddress = "192.168.1.100";

        Logger.LogInformation(
            "Usu√°rio {UserId} ({Username}) executou a√ß√£o {Action} de {IpAddress}",
            userId,
            username,
            action,
            ipAddress
        );

        Logger.LogInformation("Log estruturado criado! Verifique o arquivo de log para ver as propriedades.");
    }
}
