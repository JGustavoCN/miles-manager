### Especificação de Caso de Uso: Registrar Transação

**Identificador:** UC-02

**Ator Principal:** Usuário **Requisitos Relacionados:** RF-005 (Registrar Transação), RF-006 (Cálculo Automático), RF-008 (Validação de Dados)
**Objetivo:** Permitir que o usuário lance uma compra realizada no sistema, vinculando-a a um cartão de crédito para que o sistema calcule automaticamente a estimativa de pontos gerados.

#### 1. Pré-condições

- O Usuário deve estar devidamente autenticado no sistema.

- Deve existir ao menos um cartão de crédito previamente cadastrado e ativo para ser vinculado à transação.

#### 2. Condição de Entrada (Gatilho)

- O Usuário seleciona a opção "Nova Transação" (ou equivalente) no menu principal ou no dashboard.

#### 3. Fluxo Principal (Caminho Feliz)

Este fluxo descreve o processo de registro de uma compra válida.

1. **[Ator]** solicita a inclusão de uma nova despesa.
2. **[Sistema]** apresenta o formulário de cadastro contendo os campos: Data, Valor (R$), Descrição, Categoria e seleção de Cartão.

3. **[Ator]** preenche os campos solicitados e seleciona o cartão utilizado na compra.
4. **[Ator]** confirma a operação (clica em "Salvar").
5. **[Sistema]** executa a verificação de integridade dos campos (Include: UC-Validar Dados) para garantir que não há campos vazios, datas futuras ou valores negativos.

6. **[Sistema]** executa o processo de conversão de valores (Include: Calcular Pontos Auto - RF-006), aplicando a regra de negócio para gerar a estimativa de pontos.

7. **[Sistema]** persiste os dados da transação e o valor calculado dos pontos na base de dados.

8. **[Sistema]** apresenta mensagem de sucesso: "Transação registrada com sucesso".
9. **[Sistema]** redireciona o usuário para a listagem de transações ou Dashboard.
10. **O caso de uso termina.**

#### 4. Fluxos Alternativos (Variantes) UC-02

Caminhos opcionais de navegação.

##### **FA-01: Cancelar Registro**

- **Gatilho:** No passo 3 do Fluxo Principal.

1. **[Ator]** seleciona a opção "Cancelar" ou "Voltar".
2. **[Sistema]** descarta os dados preenchidos no formulário.
3. **[Sistema]** retorna à tela anterior (Dashboard ou Listagem).
4. **O caso de uso termina.**

#### 5. Fluxos de Exceção (Tratamento de Erros)

Caminhos onde ocorrem violações de regras de negócio ou validação.

##### **FE-01: Dados Inválidos (Violação do RF-008)**

- **Gatilho:** No passo 5 do Fluxo Principal (durante a validação).

1. **[Sistema]** detecta inconsistências, como: valor da compra negativo/zero, data da compra futura ou campos obrigatórios vazios.
2. **[Sistema]** interrompe o processo de gravação.
3. **[Sistema]** exibe mensagens de erro específicas abaixo de cada campo inválido.
4. **[Retorno]:** O fluxo retorna ao passo 3 do Fluxo Principal, mantendo os dados preenchidos para que o usuário faça a correção.

##### **FE-02: Inexistência de Cartão Vinculado**

- **Gatilho:** No passo 2 do Fluxo Principal (ao carregar o formulário).

1. **[Sistema]** verifica que não há nenhum cartão de crédito cadastrado na base de dados do usuário.
2. **[Sistema]** exibe um alerta bloqueante: "Para registrar uma transação, é necessário cadastrar um cartão primeiro".
3. **[Retorno]:** O fluxo é redirecionado para o Caso de Uso **Manter Cartões (UC-03)** ou encerra a operação.

### 6. Pós-condições

- A transação é registrada permanentemente no histórico do usuário.

- O valor estimado de pontos é calculado e salvo junto ao registro.

- O somatório total de pontos do programa de fidelidade associado ao cartão é atualizado (impactando o Dashboard).
