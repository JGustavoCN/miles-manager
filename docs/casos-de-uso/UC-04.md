### Especificação de Caso de Uso: Manter Programas

**Identificador:** UC-04

**Ator Principal:** Usuário **Requisitos Relacionados:** RF-004 (Manter Programas), RF-008 (Validação de Dados)
**Objetivo:** Permitir o cadastro e gerenciamento dos programas de fidelidade (ex: Smiles, Latam Pass, Livelo), que servirão como destino para o acúmulo de pontos gerados pelos cartões de crédito.

#### 1. Pré-condições

- O Usuário deve estar devidamente autenticado no sistema.

#### 2. Condição de Entrada (Gatilho)

- O Usuário acessa o menu "Programas de Fidelidade" e seleciona a opção "Novo Programa" (para cadastro) ou clica em um programa existente na lista (para edição/exclusão).

#### 3. Fluxo Principal (Caminho Feliz - Cadastro)

Este fluxo descreve o processo de criação de um novo programa de milhas.

1. **[Ator]** solicita a criação de um novo programa.
2. **[Sistema]** apresenta o formulário de cadastro contendo os campos: Nome do Programa (ex: Livelo) e Companhia/Banco Responsável.
3. **[Ator]** preenche os dados identificadores do programa.
4. **[Ator]** confirma a operação (clica em "Salvar").
5. **[Sistema]** executa a validação dos dados (Include: UC-Validar Dados) para garantir que o nome não está vazio e não é duplicado.
6. **[Sistema]** persiste o novo programa na base de dados.
7. **[Sistema]** apresenta mensagem de sucesso: "Programa de fidelidade cadastrado com sucesso".
8. **[Sistema]** atualiza a listagem de programas disponíveis.
9. **O caso de uso termina.**

#### 4. Fluxos Alternativos (Variantes) UC-04

Caminhos para edição e remoção de registros.

##### **FA-01: Editar Programa**

- **Gatilho:** O usuário seleciona o botão de "Editar" em um programa da listagem.

1. **[Ator]** modifica as informações (ex: corrige o Nome do Programa).
2. **[Ator]** salva as alterações.
3. **[Sistema]** valida a entrada (RF-008).
4. **[Sistema]** atualiza o registro no banco de dados.
5. **[Sistema]** exibe mensagem de confirmação.

##### **FA-02: Excluir Programa**

- **Gatilho:** O usuário aciona a opção de "Excluir" em um programa.

1. **[Sistema]** solicita confirmação crítica: "Deseja excluir o programa [Nome]? Isso pode afetar cartões vinculados."
2. **[Ator]** confirma a ação.
3. **[Sistema]** verifica a integridade referencial (se existem cartões ou saldos vinculados a este programa).
4. **[Sistema]** remove o programa da base de dados.
5. **[Sistema]** exibe mensagem de sucesso e remove o item da lista.

#### 5. Fluxos de Exceção (Tratamento de Erros)

Tratamento de violações de regras de negócio e integridade.

##### **FE-01: Dados Inválidos ou Duplicados**

- **Gatilho:** No passo 5 do Fluxo Principal.

1. **[Sistema]** detecta que o campo "Nome" está vazio ou que já existe um programa com esse mesmo nome cadastrado para o usuário.
2. **[Sistema]** bloqueia o salvamento.
3. **[Sistema]** exibe mensagem de erro: "Nome obrigatório" ou "Programa já cadastrado".
4. **[Retorno]:** O fluxo retorna ao formulário (passo 3) para ajuste.

##### **FE-02: Exclusão Bloqueada (Integridade Referencial)**

- **Gatilho:** No passo 3 do Fluxo Alternativo FA-02.

1. **[Sistema]** identifica que existem Cartões de Crédito vinculados a este programa (conforme RF-004) ou Transações registradas para ele.
2. **[Sistema]** impede a exclusão para evitar que cartões ou pontos fiquem "órfãos" (sem programa definido).
3. **[Sistema]** exibe alerta: "Não é possível excluir o programa pois existem cartões ou pontos vinculados a ele.".
4. **[Retorno]:** O caso de uso é encerrado mantendo o registro ativo.

### 6. Pós-condições

- O programa cadastrado torna-se disponível para ser vinculado a novos cartões de crédito.
- O programa passa a aparecer no Dashboard de Saldos (RF-007) para totalização de pontos.
