### Especificação de Caso de Uso: Manter Cartões

**Identificador:** UC-03

**Ator Principal:** Usuário **Requisitos Relacionados:** RF-003 (Manter Cartões), RF-008 (Validação de Dados)
**Objetivo:** Permitir que o usuário gerencie (cadastre, edite e exclua) os cartões de crédito que serão utilizados para pontuar milhas.

#### 1. Pré-condições

- O Usuário deve estar devidamente autenticado no sistema.

#### 2. Condição de Entrada (Gatilho)

- O Usuário seleciona a opção "Meus Cartões" no menu principal e clica em "Novo Cartão" (para cadastro) ou seleciona um cartão existente (para edição/exclusão).

#### 3. Fluxo Principal (Caminho Feliz - Cadastro)

Este fluxo descreve o processo de cadastro de um novo cartão.

1. **[Ator]** solicita a inclusão de um novo cartão.
2. **[Sistema]** apresenta o formulário contendo os campos: Nome do Cartão (Apelido), Bandeira (Visa/Master), Limite (R$) e Dia de Vencimento.
3. **[Ator]** preenche os dados solicitados.
4. **[Ator]** confirma a operação (clica em "Salvar").
5. **[Sistema]** executa a verificação de integridade (Include: UC-Validar Dados) para garantir campos obrigatórios e valores numéricos positivos.

6. **[Sistema]** persiste o novo cartão na base de dados do usuário.
7. **[Sistema]** apresenta mensagem de sucesso: "Cartão cadastrado com sucesso".
8. **[Sistema]** atualiza a listagem de cartões exibida na tela.
9. **O caso de uso termina.**

#### 4. Fluxos Alternativos (Variantes) UC-03

Caminhos opcionais de navegação e operações de CRUD.

##### **FA-01: Editar Cartão**

- **Gatilho:** O usuário seleciona um cartão existente na listagem.

1. **[Ator]** altera os dados desejados (ex: ajusta o Limite).
2. **[Ator]** clica em "Salvar Alterações".
3. **[Sistema]** valida os novos dados (RF-008).
4. **[Sistema]** atualiza o registro no banco de dados.
5. **[Sistema]** exibe mensagem de sucesso e retorna à listagem.

##### **FA-02: Excluir Cartão**

- **Gatilho:** O usuário clica no ícone de "Excluir" em um cartão da lista.

1. **[Sistema]** solicita confirmação: "Deseja realmente excluir o cartão [Nome]?".
2. **[Ator]** confirma a exclusão.
3. **[Sistema]** verifica se o cartão não possui transações vinculadas (Integridade Referencial).
4. **[Sistema]** remove o registro do banco de dados.
5. **[Sistema]** exibe mensagem de sucesso.

#### 5. Fluxos de Exceção (Tratamento de Erros)

Caminhos onde ocorrem violações de regras.

##### **FE-01: Dados Inválidos (Violação do RF-008)**

- **Gatilho:** No passo 5 do Fluxo Principal (validação).

1. **[Sistema]** detecta inconsistências (ex: Dia de Vencimento > 31, Limite Negativo ou Nome vazio).
2. **[Sistema]** impede a gravação.
3. **[Sistema]** destaca os campos incorretos com mensagens de erro explicativas.

4. **[Retorno]:** O fluxo retorna ao passo 3 do Fluxo Principal para correção.

##### **FE-02: Exclusão de Cartão em Uso**

- **Gatilho:** No passo 3 do Fluxo Alternativo FA-02.

1. **[Sistema]** detecta que existem transações (compras) registradas vinculadas a este cartão.
2. **[Sistema]** impede a exclusão para manter o histórico financeiro e integridade dos dados.
3. **[Sistema]** exibe alerta: "Não é possível excluir este cartão pois existem compras associadas a ele. Tente arquivar ou editar".
4. **[Retorno]:** O caso de uso encerra ou retorna à listagem.

### 6. Pós-condições

- A lista de cartões do usuário reflete as inclusões, alterações ou exclusões realizadas.
- O cartão torna-se disponível (ou indisponível) para seleção no registro de novas transações (UC-02).
